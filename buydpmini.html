<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Buy DP Mini - DP Biotech</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
<style>
  :root { 
    --bg:#ffffff; --text:#0a0a0a; --muted:#525252; --line:#e5e5e5; --card:#fafafa; 
    --a1:#f97316; --a2:#ef4444; --a3:#dc2626;
  }
  @media (prefers-color-scheme: dark){ 
    :root { --bg:#0a0a0a; --text:#fafafa; --muted:#a1a1aa; --line:#262626; --card:#18181b; } 
  }
  body{
    margin:0; 
    font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; 
    background:var(--bg); 
    color:var(--text);
    overflow: hidden; 
  }
  .container{max-width:1200px; margin:0 auto; padding:0 20px}

  /* Navigation Bar */
  .nav{position:sticky; top:0; z-index:50; background:color-mix(in srgb, var(--bg) 80%, transparent); backdrop-filter:saturate(180%) blur(10px); border-bottom:1px solid var(--line)}
  .nav-inner{height:57px; display:flex; align-items:center; justify-content:space-between}
  .logo{display:flex; gap:8px; align-items:center; font-weight:600; letter-spacing:-0.02em; font-size: 18px;}
  .nav a{color:inherit; text-decoration:none}
  .btn{display:inline-flex; align-items:center; gap:8px; padding:10px 16px; border-radius:999px; border:1px solid var(--line); font-weight:600; font-size:14px; background:transparent; color:inherit; cursor:pointer; text-decoration: none;}
  .btn.primary{background:var(--text); color:var(--bg); border-color:transparent}
  a.btn, button.btn { text-decoration: none !important; }

  /* Main grid layout */
  .config-layout{
    display:grid; 
    grid-template-columns: 3fr 2fr;
    gap: 48px;
    height: calc(100vh - 57px);
  }
  @media(max-width: 999px){
    body { overflow: auto; padding-bottom: 100px; }
    .config-layout{grid-template-columns:1fr; height: auto; gap: 0;}
    .viewer { position: static; height: auto; padding: 24px 0; }
    aside { overflow-y: visible; padding-bottom: 0; }
  }

  /* Left Column: Viewer */
  .viewer{ padding: 24px 0; }
  .viewer-frame{width:100%; height: 50vh; min-height:400px; border-radius:18px; border:1px solid var(--line); background:var(--card)}
  model-viewer {width: 100%; height: 100%; border-radius: 18px; --poster-color: transparent;}
  
  /* Right Column: Options */
  aside {
    padding-top: 24px;
    overflow-y: scroll;
    padding-bottom: 120px;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  aside::-webkit-scrollbar {
    display: none;
  }
  
  h1{font-size:clamp(28px, 4vw, 36px); letter-spacing:-.02em; margin:0 0 24px 0; font-weight:800;}
  .option-group{margin-bottom:24px; border:1px solid var(--line); border-radius:18px; overflow:hidden;}
  .group-header{padding:16px; display:flex; justify-content:space-between; align-items:center; background:var(--card);}
  .group-header strong{font-size:18px;}
  .option-list{padding:16px; display:flex; flex-direction:column; gap:12px;}
  .choice{display:flex; justify-content:space-between; align-items:center; gap:16px; border:2px solid var(--line); border-radius:12px; padding:16px; background:var(--bg); cursor:pointer; transition: all .2s ease;}
  .choice.selected{border-color:var(--a2); box-shadow:0 0 0 4px color-mix(in srgb, var(--a2) 20%, transparent);}
  .choice:hover{border-color:var(--a1);}
  .choice input{display:none}
  .choice-details strong{font-weight:600; font-size:15px;}
  .choice-details small{display:block; color:var(--muted); font-size:13px; margin-top:2px;}
  .price-delta{color:var(--text); font-weight:600; white-space:nowrap; font-size:14px;}

  /* Phone Dropdown */
  .select-wrapper { position: relative; padding: 16px; }
  .select-wrapper::after { content: '⌄'; position: absolute; top: 50%; right: 32px; transform: translateY(-50%); pointer-events: none; font-size: 20px; color: var(--muted); }
  select.custom-select { width: 100%; padding: 16px; border: 2px solid var(--line); border-radius: 12px; background: var(--bg); font-size: 16px; font-weight: 500; font-family: inherit; appearance: none; -webkit-appearance: none; cursor: pointer; }

  /* Sticky Bottom Bar */
  .sticky-bar{position:fixed; left:0; right:0; bottom:0; background:color-mix(in srgb, var(--bg) 80%, transparent); backdrop-filter:saturate(180%) blur(10px); border-top:1px solid var(--line); z-index:45;}
  .bar-inner{max-width:1200px; margin:0 auto; padding:16px 20px; display:flex; align-items:center; justify-content:space-between; gap:16px}
  .total-price .label{font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.05em;}
  .total-price .amount{font-size:24px; font-weight:700; color:var(--text);}

  /* --- MODIFICATION START: Updated Cart Styles --- */
  .cart-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.4);
    z-index: 90;
    opacity: 0;
    visibility: hidden;
    transition: opacity .3s ease, visibility .3s ease;
  }
  .cart-backdrop.is-visible {
    opacity: 1;
    visibility: visible;
  }
  .cart-sidebar {
    position: fixed;
    top: 0;
    right: 0;
    width: 100%;
    max-width: 400px;
    height: 100%;
    background: var(--bg);
    border-left: 1px solid var(--line);
    z-index: 100;
    transform: translateX(100%);
    transition: transform .3s ease;
    display: flex;
    flex-direction: column;
    box-shadow: -10px 0 20px rgba(0,0,0,0.1);
    padding: 0; 
  }
  .cart-sidebar.is-open {
    transform: translateX(0);
  }
  .cart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid var(--line);
    padding: 1rem 2rem;
    flex-shrink: 0;
  }
  .cart-items {
    list-style: none;
    padding: 1rem 2rem;
    margin: 0;
    flex-grow: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
  .cart-item {
    padding: 0;
    border-bottom: none;
  }
  .cart-product-card {
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: 16px;
    background: var(--card);
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    position: relative;
  }
  .cart-product-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px;
  }
  .cart-product-title {
    font-size: 16px;
    font-weight: 600;
    margin: 0;
  }
  .cart-product-subtitle {
    font-size: 13px;
    color: var(--muted);
    margin: 4px 0 12px 0;
    font-weight: 400;
  }
  .cart-product-price {
    font-size: 15px;
    font-weight: 500;
  }
  .cart-product-remove-btn {
    background: none;
    border: none;
    font-size: 24px;
    line-height: 1;
    padding: 0;
    margin-left: 10px;
    cursor: pointer;
    color: var(--muted);
    transition: color .2s ease;
  }
  .cart-product-remove-btn:hover {
    color: var(--text);
  }
  .cart-total {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 18px;
    font-weight: 600;
  }
  .cart-empty-state {
    text-align: center;
    padding: 2rem;
    color: var(--muted);
    margin: auto 0;
  }
  .cart-footer {
    border-top: 1px solid var(--line);
    padding: 1rem 2rem 2rem 2rem;
    margin-top: auto;
    flex-shrink: 0;
  }

  .quantity-control {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .quantity-btn {
    width: 28px; height: 28px; border-radius: 6px;
    font-size: 18px; padding: 0;
    display: grid;
    place-items: center;
    line-height: 0;
  }
  .quantity-input {
    width: 32px;
    height: 28px;
    text-align: center;
    border: 1px solid var(--line);
    border-radius: 6px;
    font-family: inherit;
    font-weight: 600;
    -moz-appearance: textfield;
  }
  .quantity-input::-webkit-outer-spin-button,
  .quantity-input::-webkit-inner-spin-button {
    -webkit-appearance: none; margin: 0;
  }
  .cart-item-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 12px;
  }
  /* --- MODIFICATION END --- */
</style>
</head>
<body>
  <div class="nav">
    <div class="container nav-inner">
      <a href="index.html" class="logo">
        <img src="logo.png" alt="DP Biotech Logo" style="height:34px; border-radius:50%;">
        <span>DP Biotech</span>
      </a>
      <div style="display:flex; gap:8px;">
        <a href="DPMini.html" class="btn">Cancel</a>
        <button id="cart-btn" class="btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <path d="M16 10a4 4 0 0 1-8 0"></path>
          </svg>
          <span id="cart-count">0</span>
        </button>
      </div>
    </div>
  </div>
  
  <div class="cart-backdrop" id="cart-backdrop"></div>
  <div class="cart-sidebar" id="cart-sidebar">
    <div class="cart-header">
      <h3 style="margin:0;">Your Cart</h3>
      <button class="btn" id="close-cart-btn">Close</button>
    </div>
    <div id="cart-empty-state" class="cart-empty-state">
      Your cart is empty.
    </div>
    <ul class="cart-items" id="cart-items">
      </ul>
    <div class="cart-footer">
      <div class="cart-total">
        <span>Total</span>
        <span id="cart-total-price">€0,00</span>
      </div>
      <button id="checkout-btn" class="btn primary" style="width:100%; margin-top:1rem;">Checkout</button>
      <button id="clear-cart-btn" class="btn" style="width:100%; margin-top:0.5rem;">Clear Cart</button>
      </div>
  </div>

  <div class="container">
      <div class="config-layout">
        <section class="viewer">
            <h1>Configure your DP Mini</h1>
            <div class="viewer-frame">
              <model-viewer src="dpmini.glb" ios-src="dpmini.usdz" alt="DP Mini mobile microscope" 
                  camera-controls ar shadow-intensity="1" camera-orbit="230deg 80deg 1.5m" interaction-prompt="none">
              </model-viewer>
            </div>
        </section>

        <aside>
            <div class="option-group">
            <div class="group-header"><strong>Device</strong><small>Select your phone model</small></div>
            <div class="select-wrapper">
                <select class="custom-select" name="phone_model">
                <option>iPhone 17 Pro Max</option>
                <option>iPhone 17 Pro</option>
                <option>iPhone 17 Plus</option>
                <option>iPhone 17</option>
                <option>iPhone 16 Pro Max</option>
                <option>iPhone 16 Pro</option>
                <option>iPhone 16 Plus</option>
                <option>iPhone 16</option>
                <option selected>iPhone 15 Pro Max</option>
                <option>iPhone 15 Pro</option>
                <option>iPhone 15 Plus</option>
                <option>iPhone 15</option>
                </select>
            </div>
            </div>

            <div class="option-group">
            <div class="group-header"><strong>Objective</strong><small>Select working distance</small></div>
            <div class="option-list" id="objective-options">
                <label class="choice" data-price="0"><input type="radio" name="objective" value="50mm" checked><div class="choice-details"><strong>50mm Standard Objective</strong><small>Ideal for close-up work, maximum magnification.</small></div><span class="price-delta">Included</span></label>
                <label class="choice" data-price="180"><input type="radio" name="objective" value="60mm"><div class="choice-details"><strong>60mm Mid-Range Objective</strong><small>Balanced distance and magnification.</small></div><span class="price-delta">+ €180</span></label>
                <label class="choice" data-price="350"><input type="radio" name="objective" value="75mm"><div class="choice-details"><strong>75mm Long-Range Objective</strong><small>Maximum working space for tools.</small></div><span class="price-delta">+ €350</span></label>
            </div>
            </div>

            <div class="option-group">
            <div class="group-header"><strong>Eyepieces</strong><small>Choose your viewing method</small></div>
            <div class="option-list" id="eyepiece-options">
                <label class="choice" data-price="0"><input type="radio" name="eyepiece" value="Screen" checked><div class="choice-details"><strong>Screen Only</strong><small>Use your smartphone screen for direct viewing.</small></div><span class="price-delta">Included</span></label>
                <label class="choice" data-price="290"><input type="radio" name="eyepiece" value="Full HD"><div class="choice-details"><strong>Full HD Eyepieces</strong><small>Immersive 1920x1080 resolution per eye.</small></div><span class="price-delta">+ €290</span></label>
                <label class="choice" data-price="580"><input type="radio" name="eyepiece" value="4K UHD"><div class="choice-details"><strong>4K UHD Eyepieces</strong><small>Ultra-high resolution for critical detail.</small></div><span class="price-delta">+ €580</span></label>
            </div>
            </div>

            <div class="option-group">
            <div class="group-header"><strong>Mounting</strong><small>Select your setup</small></div>
            <div class="option-list" id="mount-options">
                <label class="choice" data-price="0"><input type="radio" name="mount" value="Handle" checked><div class="choice-details"><strong>Ergonomic Handle</strong><small>For handheld operation with multifunction controls.</small></div><span class="price-delta">Included</span></label>
                <label class="choice" data-price="220"><input type="radio" name="mount" value="Arm"><div class="choice-details"><strong>Articulated Arm with Clamp</strong><small>For stable, hands-free positioning.</small></div><span class="price-delta">+ €220</span></label>
            </div>
            </div>
        </aside>
    </div>
  </div>

  <div class="sticky-bar">
    <div class="bar-inner container">
      <div class="total-price">
        <div class="label">Total Price</div>
        <div class="amount" id="total-price-display">€2.990,00</div>
      </div>
      <button id="addToCartBtn" class="btn primary" style="padding: 14px 28px; font-size: 16px;">Add to Cart</button>
    </div>
  </div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const basePrice = 2990;
    const choices = document.querySelectorAll('.choice');
    const totalPriceDisplay = document.getElementById('total-price-display');
    const EUR = new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' });

    // --- MODIFICATION START: Upgraded Cart Script ---
    const cartBtn = document.getElementById('cart-btn');
    const cartCountEl = document.getElementById('cart-count');
    const addToCartBtn = document.getElementById('addToCartBtn');
    const cartSidebar = document.getElementById('cart-sidebar');
    const cartBackdrop = document.getElementById('cart-backdrop');
    const closeCartBtn = document.getElementById('close-cart-btn');
    const cartItemsList = document.getElementById('cart-items');
    const cartEmptyState = document.getElementById('cart-empty-state');
    const cartTotalPriceEl = document.getElementById('cart-total-price');
    const checkoutBtn = document.getElementById('checkout-btn');
    const clearCartBtn = document.getElementById('clear-cart-btn');
    let cart = [];

    function initCart() {
      const savedCart = sessionStorage.getItem('shoppingCart');
      if (savedCart) {
        cart = JSON.parse(savedCart);
      }
      updateCartUI();
    }

    function saveCart() {
      sessionStorage.setItem('shoppingCart', JSON.stringify(cart));
      updateCartUI();
    }

    function formatOptions(options) {
        if (typeof options === 'object' && options !== null) {
            return Object.values(options).filter(val => val).join(', ');
        }
        return options || '';
    }

    function changeQuantity(itemId, amount) {
        if (amount > 0) {
            const itemToAdd = cart.find(item => item.id === itemId);
            if (itemToAdd) {
                cart.push({...itemToAdd});
            }
        } else if (amount < 0) {
            const itemIndexToRemove = cart.findIndex(item => item.id === itemId);
            if (itemIndexToRemove > -1) {
                cart.splice(itemIndexToRemove, 1);
            }
        }
        saveCart();
    }

    function removeItem(itemId) {
        cart = cart.filter(item => item.id !== itemId);
        saveCart();
    }

    function updateCartUI() {
      const consolidatedCart = {};
      cart.forEach(item => {
        if (consolidatedCart[item.id]) {
          consolidatedCart[item.id].quantity++;
        } else {
          consolidatedCart[item.id] = { ...item, quantity: 1 };
        }
      });
      const displayCart = Object.values(consolidatedCart);

      cartItemsList.innerHTML = '';
      
      let total = 0;
      cart.forEach(item => { total += item.price; });

      if (displayCart.length === 0) {
        cartEmptyState.style.display = 'block';
        checkoutBtn.disabled = true;
        clearCartBtn.disabled = true;
      } else {
        cartEmptyState.style.display = 'none';
        checkoutBtn.disabled = false;
        clearCartBtn.disabled = false;

        displayCart.forEach((item) => {
          const li = document.createElement('li');
          li.className = 'cart-item';
          const baseName = item.name.split('(')[0].trim();
          const formattedOptions = formatOptions(item.options);
          
          li.innerHTML = `
            <div class="cart-product-card">
                <div class="cart-product-header">
                    <h4 class="cart-product-title">${baseName}</h4>
                    <button class="cart-product-remove-btn" data-action="remove" data-id="${item.id}">&times;</button>
                </div>
                <p class="cart-product-subtitle">${formattedOptions}</p>
                <div class="cart-item-actions">
                    <div class="quantity-control">
                        <button class="btn quantity-btn" data-action="decrease" data-id="${item.id}">-</button>
                        <input type="number" class="quantity-input" value="${item.quantity}" min="1" readonly>
                        <button class="btn quantity-btn" data-action="increase" data-id="${item.id}">+</button>
                    </div>
                    <div class="cart-product-price">${EUR.format(item.price)}</div>
                </div>
            </div>
          `;
          cartItemsList.appendChild(li);
        });
      }

      cartCountEl.textContent = cart.length;
      cartTotalPriceEl.textContent = EUR.format(total);
    }
    
    function addToCart() {
      const objective = document.querySelector('input[name="objective"]:checked').value;
      const eyepiece = document.querySelector('input[name="eyepiece"]:checked').value;
      const mount = document.querySelector('input[name="mount"]:checked').value;
      const phone = document.querySelector('select[name="phone_model"]').value;

      let currentTotal = basePrice;
      const selectedPrices = document.querySelectorAll('input[type="radio"]:checked');
      selectedPrices.forEach(option => {
        currentTotal += Number(option.closest('.choice').dataset.price);
      });

      const newItem = {
        id: `dpmini-${objective}-${eyepiece}-${mount}-${phone}`,
        name: `DP Mini (${objective} Objective, ${eyepiece} Eyepiece, ${mount} Mount)`,
        price: currentTotal,
        options: { 
            phone: phone,
            objective: objective, 
            eyepiece: eyepiece, 
            mount: mount
        }
      };
      
      cart.push(newItem);
      saveCart();
      
      cartSidebar.classList.add('is-open');
      cartBackdrop.classList.add('is-visible');
    }
    
    function calculateTotal() {
      let currentTotal = basePrice;
      const selectedOptions = document.querySelectorAll('input[type="radio"]:checked');
      selectedOptions.forEach(option => {
        currentTotal += Number(option.closest('.choice').dataset.price);
      });
      totalPriceDisplay.textContent = EUR.format(currentTotal);
    }

    function updateSelectionUI() {
      choices.forEach(choice => {
        const radio = choice.querySelector('input');
        if (radio.checked) {
          choice.classList.add('selected');
        } else {
          choice.classList.remove('selected');
        }
      });
    }

    choices.forEach(choice => {
      choice.addEventListener('click', () => {
        const radio = choice.querySelector('input');
        radio.checked = true;
        radio.dispatchEvent(new Event('change', { bubbles: true }));
      });
    });

    document.body.addEventListener('change', (event) => {
      if (event.target.type === 'radio') {
        updateSelectionUI();
        calculateTotal();
      }
    });

    addToCartBtn.addEventListener('click', addToCart);

    cartBtn.addEventListener('click', () => {
      cartSidebar.classList.add('is-open');
      cartBackdrop.classList.add('is-visible');
    });

    closeCartBtn.addEventListener('click', () => {
      cartSidebar.classList.remove('is-open');
      cartBackdrop.classList.remove('is-visible');
    });

    cartBackdrop.addEventListener('click', () => {
      cartSidebar.classList.remove('is-open');
      cartBackdrop.classList.remove('is-visible');
    });
    
    cartItemsList.addEventListener('click', (e) => {
        const target = e.target.closest('button');
        if (!target) return;

        const action = target.dataset.action;
        const id = target.dataset.id;
        
        if (!id) return;

        if (action === 'increase') {
            changeQuantity(id, 1);
        } else if (action === 'decrease') {
            changeQuantity(id, -1);
        } else if (action === 'remove') {
            removeItem(id);
        }
    });

    clearCartBtn.addEventListener('click', () => {
        cart = [];
        saveCart();
    });

    checkoutBtn.addEventListener('click', () => {
        window.location.href = 'checkout.html';
    });

    window.onbeforeunload = function(event) {
        if (cart.length > 0) {
            const message = "Your cart contains items. Are you sure you want to leave?";
            event.returnValue = message; 
            return message;
        }
    };

    initCart();
    updateSelectionUI();
    calculateTotal();
    // --- MODIFICATION END ---
  });
</script>
</body>
</html>